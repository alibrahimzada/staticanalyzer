# StatiCFG
Python3 control flow graph generator

StatiCFG is a package that can be used to produce control flow graphs (CFGs) for Python 3 programs. The CFGs it generates
can be easily visualised with graphviz and used for static analysis. This analysis is actually the main purpose of
the module, hence the name of **StatiC**FG.

Below is an example of a piece of code that generates the Fibonacci sequence and the CFG produced for it with StatiCFG.

```python
def fib():
    a, b = 0, 1
    while True:
        yield a
        a, b = b, a + b

fib_gen = fib()
for _ in range(10):
    next(fib_gen)
```

![Fibonacci CFG](assets/example_cfg.png)

## Installation

To install StatiCFG, simply clone this repository and run the command `pip3 install --upgrade .` inside of it. Please note that
you will also need to install [Graphviz](https://www.graphviz.org/) on your machine to be able to visualise the control flow
graphs generated by StatiCFG.

## Usage

To use StatiCFG, simply import the module in your Python interpreter or program, and use the `staticfg.CFGBuilder` class to 
build CFGs. For example, to build the CFG of a program defined in a file with the path *./example.py*, the following code can 
be used:

```
from staticfg import CFGBuilder

cfg = CFGBuilder().build_from_file('example.py', './example.py')
```

This returns the CFG for the code in *./example.py* in the `cfg` variable. The first parameter of `build_from_file` is the 
desired name for the CFG, and the second one is the path to the file containing the source code. The produced CFG can then be 
visualised with:

```
cfg.build_visual('exampleCFG', 'pdf')
```

`build_from_file` also writes a text file (`example.py_dfg.txt`) describing the
data flow paths through the program. Each path is a sequence of variable
occurrences like `(x, 1) -> (x, 2)`.

The first paramter of `build_visual` is the desired name for the DOT file produced by the method, and the second one is the
format to use for the visualisation.

The *build_cfg.py* script present in the */examples* folder of this repository can be used to directly generate the CFG of some 
Python program and visualise it. To do so, simply call the script with the command `python3 build_cfg.py 
<path_to_some_source>`.

## Java Support

StatiCFG also provides a minimal CFG builder for Java source files using the
Tree-sitter parser. You can build and visualise a Java method's CFG with:

```python
from javacfg import CFGBuilder

cfg = CFGBuilder().build_from_file('Example.java', './Example.java')
cfg.build_visual('example_java_cfg.dot', 'pdf')
```

This produces a DOT file (`example_java_cfg.dot`) describing the control flow of
the method which can be rendered with Graphviz.

## Rust, Go and C Support

StatiCFG includes minimal CFG builders for Rust, Go and C. They behave like the
Java builder: if the appropriate tree-sitter bindings are installed they will be
used, otherwise a simple line based parser provides a fallback. Usage mirrors
the Java example; import the desired language package (`rust`, `go` or `c`) and
call `CFGBuilder().build_from_file()` on your source file.

## JavaScript Support

A basic CFG builder for JavaScript is also available. Usage mirrors the Java
example:

```python
from javascript import CFGBuilder

cfg = CFGBuilder().build_from_file('example.js', './example.js')
cfg.build_visual('example_js_cfg.dot', 'pdf')
```

Like the other builders, it relies on Tree-sitter for parsing when available and
falls back to a very simple line based parser otherwise.
